@if (campaign) {
<div class="top">
    <div class="header-container">
        <h1>
            @if (goBackFunction) {
                <button mat-button 
                        class="back-button"
                        (click)="goBackFunction!()"
                        matTooltip="Go back"
                        matTooltipPosition="below"
                        aria-label="Go back">
                    <mat-icon class="back-icon">chevron_left</mat-icon>
                </button>
            }
            Select Your Starting Position in: <span class="region-name">{{ assignment.region_key }}</span>
        </h1>
    </div>
    <div class="timer-container">
        <app-timer [label]="'Deadline:'" [endDate]="campaign.getStartDeadlineDate()"></app-timer>
    </div>
</div>

<div class="middle">
    <div class="render-wrapper">
        <app-polygon-select #polygonSelect [colorConfigProviders]="[colorConfigProvider]"
            (selectionChanged)="onSelect($event.key, $event.locked)"
            [tooltipProvider]="tooltipProvider" [meshBuddiesProvider]="meshBuddiesProvider"></app-polygon-select>
    </div>
    <div class="side-container">
        <div class="content-wrapper">
            @if (hasSelectedPosition()) {
                <div class="selection-info">
                    <h3>County of:</h3>
                    <p><strong>{{ getSelectedPositionName() }}</strong></p>
                </div>
            }
            @if (!hasSelectedPosition()) {
                <p>Click on a county in the map to select your starting county.</p>
            }
            <span>Bitte stellt sicher, dass euer Character:</span>
            <ul>
                <li>Maximal 400 Punkte wert ist</li>
                <li>Eine Religion und Kultur die in mindestens einer Provinz in der Region vorkommt hat</li>
                <li>Nicht auf gebauten Monumenten oder Minen (gebaut oder ungebaut) startet</li>
            </ul>
            @if (ruler) {
                <div class="character-info">
                    <button mat-icon-button class="close-ruler-btn" (click)="clearRuler()" matTooltip="Remove uploaded ruler" matTooltipPosition="below" aria-label="Remove uploaded ruler" style="float:right;">
                        <mat-icon>close</mat-icon>
                    </button>
                    <h3>{{ ruler.name }} ({{ ruler.age }})</h3>
                    <div class="character-details">
                        <p><strong>Culture:</strong> {{ ruler.culture }}</p>
                        <p><strong>Faith:</strong> {{ ruler.faith }}</p>
                        <div class="traits-layout">
                            @if (ruler.educationTrait) {
                                <div class="education-section">
                                    <img [src]="ruler.educationTrait.getTraitIconUrl()" 
                                         [alt]="getLocalizedTraitName(ruler.educationTrait.getName())"
                                         class="trait-icon education"
                                         [matTooltip]="getLocalizedTraitName(ruler.educationTrait.getName())"
                                         matTooltipPosition="above">
                                </div>
                            }
                            @if (ruler.traits && ruler.traits.length > 0) {
                                <div class="traits-compact">
                                    @for (trait of ruler.traits; track trait.getName()) {
                                        <img [src]="trait.getTraitIconUrl()" 
                                             [alt]="getLocalizedTraitName(trait.getName())"
                                             class="trait-icon"
                                             [matTooltip]="getLocalizedTraitName(trait.getName())"
                                             matTooltipPosition="above">
                                    }
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }

            <div class="upload-section">
                <input #fileInput type="file" accept=".ck3ruler" (change)="onFileSelected($event)" style="display: none;" />
                @if (!ruler) {
                    <button mat-flat-button 
                            color="primary" 
                            class="upload-button" 
                            [disabled]="!hasSelectedPosition()"
                            [matTooltip]="!hasSelectedPosition() ? 'Please select a position first' : 'Upload your custom ruler file'"
                            matTooltipPosition="above"
                            (click)="fileInput.click()">
                        Upload Ruler
                    </button>
                }
                <button mat-flat-button
                        color="accent"
                        class="upload-button"
                        [disabled]="!hasSelectedPosition() || !rulerFileContent"
                        [matTooltip]="!hasSelectedPosition() ? 'Please select a position first' : (!rulerFileContent ? 'Please upload a ruler file first' : 'Upload your selection and ruler')"
                        matTooltipPosition="above"
                        (click)="uploadSelection()">
                    Submit Start & Ruler
                </button>
            </div>
        </div>
    </div>
</div>
}
@if (!campaign) {
<div class="error-container">
    <p>Something went wrong. No campaign data available.</p>
</div>
}