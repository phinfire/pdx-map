<div class="main">
    <div class="top">
        <div></div>
        <button mat-icon-button class="back-button" (click)="redirectToAdmin()" matTooltip="Go back"
            matTooltipPosition="below" aria-label="Go back">
            <mat-icon>chevron_left</mat-icon>
        </button>
        <div class="discord-container">
            @if (!discordAuthService.isLoggedIn()) {
            <app-discord-login></app-discord-login>
            }
            @if (discordAuthService.isLoggedIn()) {
            <app-discord-field></app-discord-field>
            }
        </div>
        <div></div>
    </div>
    <div class="tool-bar action-toolbar" style="display: flex; gap: 12px; align-items: center; margin-bottom: 8px; flex-wrap: wrap;">
        <button mat-flat-button color="primary" class="action-button" (click)="pullServerToLocal()"
            matTooltip="Pull assignments from the server">Pull</button>
        <div class="swap-row" style="display: flex; align-items: center; gap: 16px;">
            <mat-form-field appearance="outline" class="user-select" style="min-width: 180px;">
                <mat-label>User 1</mat-label>
                <mat-select [(ngModel)]="swapUser1">
                    <mat-option value="">-- Select User --</mat-option>
                    @for (user of getUsers(); track user.id) {
                    <mat-option [value]="user.id">{{ user.global_name || user.username }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
            <button mat-icon-button color="primary" (click)="swapAssignments()" [disabled]="!swapUser1 || !swapUser2" matTooltip="Swap assignments between selected users">
                <mat-icon>swap_horiz</mat-icon>
            </button>
            <mat-form-field appearance="outline" class="user-select" style="min-width: 180px;">
                <mat-label>User 2</mat-label>
                <mat-select [(ngModel)]="swapUser2">
                    <mat-option value="">-- Select User --</mat-option>
                    @for (user of getUsers(); track user.id) {
                    <mat-option [value]="user.id">{{ user.global_name || user.username }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
        </div>

        <button mat-flat-button color="primary" class="action-button" (click)="assign()"
            matTooltip="{{ getAssignButtonTooltip() }}">Assign</button>
        <button mat-flat-button color="primary" class="action-button" (click)="confirmAssignments()"
            [disabled]="!canConfirmAssignments()" matTooltip="Confirm the current assignments and publish them">Confirm
            & Publish</button>
    </div>

    <div class="tool-bar selection-toolbar" style="display: flex; gap: 24px; align-items: flex-end; flex-wrap: wrap;">
        <div class="region-selection-section">
            <mat-form-field appearance="outline" class="region-select">
                <mat-label>Regions</mat-label>
                <mat-select multiple [(ngModel)]="selectedRegions" (selectionChange)="onRegionSelectionChange()">
                    <mat-select-trigger>
                        {{ getSelectedRegionCount() }}
                    </mat-select-trigger>
                    @for (region of loadedRegions; track $index) {
                    <mat-option [value]="region">{{ region }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
            <button mat-icon-button color="primary" (click)="resetSelectedRegions()" matTooltip="Reset regions"
                class="reset-button">
                <mat-icon>refresh</mat-icon>
            </button>
        </div>
        <div class="region-selection-section">
            <mat-form-field appearance="outline" class="user-select">
                <mat-label>Players</mat-label>
                <mat-select multiple [(ngModel)]="selectedPlayers" (selectionChange)="onPlayerSelectionChange()"
                    [compareWith]="compareUsers">
                    <mat-select-trigger>
                        {{ getSelectedPlayerCount() }}
                    </mat-select-trigger>
                    @for (user of loadedUsers; track user.id) {
                    <mat-option [value]="user">{{ user.global_name || user.username }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
            <button mat-icon-button color="primary" (click)="resetSelectedPlayers()" matTooltip="Reset players"
                class="reset-button">
                <mat-icon>refresh</mat-icon>
            </button>
        </div>
        <div class="remove-user-section">
            <mat-form-field appearance="outline" class="user-select">
                <mat-label>Select user to remove</mat-label>
                <mat-select [(ngModel)]="selectedUserToRemove">
                    <mat-option value="">-- Select User --</mat-option>
                    @for (user of getUsers(); track user.id) {
                    <mat-option [value]="user.id">{{ user.global_name || user.username }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
            <button mat-flat-button color="warn" class="action-button" (click)="removeUserSignup()"
                [disabled]="!selectedUserToRemove" matTooltip="Remove the selected user's signup">Remove Signup</button>
        </div>
    </div>
    <div class="center">
        <div class="table-container">
            <app-table [rowElements]="getUsers()" [columns]="getColumns()"></app-table>
        </div>
    </div>
</div>